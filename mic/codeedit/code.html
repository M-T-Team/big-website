<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VS Code Style Editor with Live Preview</title>
<style>
  html, body {
    margin:0; padding:0; height:100%; background:#1e1e1e; color:#ddd; font-family: sans-serif;
    overflow: hidden;
  }
  #toolbar {
    display: flex;
    align-items: center;
    gap: 10px;
    background: #2d2d2d;
    padding: 6px 10px;
  }
  #editorContainer {
    display: flex;
    height: calc(100% - 40px);
  }
  #editor {
    flex: 1;
    height: 100%;
  }
  #preview {
    flex: 1;
    height: 100%;
    border-left: 2px solid #444;
    display: none;
    background: white;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
  }
  select, button {
    background: #444;
    border: none;
    color: #ddd;
    padding: 5px 12px;
    border-radius: 3px;
    cursor: pointer;
  }
  select:hover, button:hover {
    background: #555;
  }
</style>
</head>
<body>

<div id="toolbar">
  <label for="langSelect">Language:</label>
  <select id="langSelect">
    <option value="html">HTML</option>
    <option value="css">CSS</option>
    <option value="javascript">JavaScript</option>
    <option value="python">Python</option>
    <option value="c">C</option>
    <option value="cpp">C++</option>
    <option value="java">Java</option>
    <option value="plaintext">Plain Text</option>
  </select>
  <button id="openFileBtn">Open File</button>
  <input type="file" id="fileInput" style="display:none" />
  <button id="downloadBtn">Download</button>
  <button id="exitBtn">Exit</button> <!-- NEW BUTTON -->
</div>

<div id="editorContainer">
  <div id="editor"></div>
  <div id="preview"><iframe id="previewFrame" sandbox="allow-scripts allow-same-origin"></iframe></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
<script>
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    const previewableLangs = ['html', 'css', 'javascript'];
    const langSelect = document.getElementById('langSelect');
    const previewDiv = document.getElementById('preview');
    const iframe = document.getElementById('previewFrame');
    const openFileBtn = document.getElementById('openFileBtn');
    const fileInput = document.getElementById('fileInput');
    const downloadBtn = document.getElementById('downloadBtn');
    const exitBtn = document.getElementById('exitBtn');

  // Add the exit button listener:
  exitBtn.addEventListener('click', () => {
    window.location.href = '../indexmic.html';
  });

    let currentBlobUrl = null;

    const editor = monaco.editor.create(document.getElementById('editor'), {
      value: `<!DOCTYPE html>
<html>
  <head>
    <title>Hello World</title>
  </head>
  <body>
    <h1>Welcome to your editor!</h1>
  </body>
</html>`,
      language: 'html',
      theme: 'vs-dark',
      automaticLayout: true,
      readOnly: false
    });

    function revokeCurrentBlob() {
      if (currentBlobUrl) {
        URL.revokeObjectURL(currentBlobUrl);
        currentBlobUrl = null;
      }
    }

    function updatePreview() {
      const lang = langSelect.value;
      if (previewableLangs.includes(lang)) {
        previewDiv.style.display = 'block';

        let content = '';
        if (lang === 'html') {
          content = editor.getValue();
        } else if (lang === 'css') {
          content = `<style>${editor.getValue()}</style><div>CSS Preview</div>`;
        } else if (lang === 'javascript') {
          content = `<script>${editor.getValue()}<\/script><div>JS Preview</div>`;
        }

        revokeCurrentBlob();
        currentBlobUrl = URL.createObjectURL(new Blob([content], {type: 'text/html'}));
        iframe.src = currentBlobUrl;

      } else {
        previewDiv.style.display = 'none';
        revokeCurrentBlob();
        iframe.src = 'about:blank';
      }
    }

    editor.onDidChangeModelContent(() => {
      updatePreview();
    });

    langSelect.addEventListener('change', () => {
      monaco.editor.setModelLanguage(editor.getModel(), langSelect.value);
      updatePreview();
    });

    openFileBtn.addEventListener('click', () => {
      fileInput.value = null;
      fileInput.click();
    });

    fileInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        editor.setValue(reader.result);
      };
      reader.readAsText(file);
    });

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([editor.getValue()], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'code.txt';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(a.href);
        document.body.removeChild(a);
      }, 0);
    });

    updatePreview();
  });
</script>

</body>
</html>
